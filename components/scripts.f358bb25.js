"use strict";angular.module("myApp",["ngAnimate","ngRoute","ngSanitize","ngTouch","ngMaterial","debounce","ui.codemirror","ui.grid","ui.grid.autoResize","xeditable","hc.downloader","hc.marked"]).config(["$logProvider","myConfig",function(a,b){a.debugEnabled(b.debug)}]).config(["$mdThemingProvider",function(a){a.theme("default").primaryColor("blue").accentColor("orange").backgroundColor("blue-grey")}]).run(["editableOptions",function(a){a.theme="bs3"}]),angular.module("myApp").constant("myConfig",{title:"vis-bin",debug:"true"}).run(["$rootScope","myConfig",function(a,b){a.myConfig=b}]),function(){function a(a,b,c,d,e,f){var g=this;g.isPrintView=!1,g.dataPackage=f,g.selectedTab=0,g.tabs=[{name:"Report",index:-1}];var h=b.hash();h&&angular.forEach(g.dataPackage.resources,function(a){a.active=h===a.name,b.replace().hash("")}),g.refreshTabs=function(a){a.drawn||d(function(){a.drawn=!0})},g._refreshTabs=function(){var a=1;g.dataPackage.resources.forEach(function(b,c){if(b.show!==!1){var d={name:b.name,resource:b,index:c};g.tabs[a]?angular.copy(d,g.tabs[a]):g.tabs.push(d),a++}})},g.fileChanged=function(a){f.isDirty=!0,a&&(a.isDirty=!0),g._refreshTabs()},g.refresh=function(){c.debug("main.refresh"),g.selectedTab=0,f.isDirty=!0,a.$broadcast("report:refresh")},g.togglePreview=function(){g.isPrintView=!g.isPrintView,g.refresh()},g.codemirrorLoaded=function(a){d(function(){a.refresh()},100)},g.refresh(),g._refreshTabs(),g.tabSelected=function(a){var b=g.tabs[a];g.resource=void 0,0===a&&f.isDirty?g.refresh():b&&b.resource&&(g.resource=b.resource)},g.newFile=function(a){var b;b=arguments.length<1?{name:"new.txt",type:"plain/text",content:""}:{name:a.name,type:e(a.name),content:a.content||""},b.active=!0,g.dataPackage.resources.push(b),g.fileChanged(b),0===g.selectedTab?g.refresh():(g.selectedTab=g.tabs.length-1,g.tabSelected(g.selectedTab))}}a.$inject=["$scope","$location","$log","$timeout","mimeType","dataPackage"],a.resolve={dataPackage:["$route","DataServiceFactory",function(a,b){var c=a.current.params.id||"index",d=a.current.params.conn||"data";return new b(d,c).load()}]},a.config=function(b){b.when("/view/:id/",{templateUrl:"components/main/preview.html",controller:"MainCtrl as main",resolve:a.resolve,reloadOnSearch:!1}).when("/edit/:id/",{templateUrl:"components/main/main.html",controller:"MainCtrl as main",resolve:a.resolve,reloadOnSearch:!1}).when("/:conn/:id/",{templateUrl:"components/main/main.html",controller:"MainCtrl as main",resolve:a.resolve,reloadOnSearch:!1}).when("/:id/",{templateUrl:"components/main/preview.html",controller:"MainCtrl as main",resolve:a.resolve,reloadOnSearch:!1}).when("/",{templateUrl:"components/main/preview.html",controller:"MainCtrl as main",resolve:a.resolve,reloadOnSearch:!1}).otherwise({redirectTo:"/"})},angular.module("myApp").controller("MainCtrl",a).config(["$routeProvider",a.config]).directive("getSvgs",function(){return{scope:{getSvgs:"="},link:function(a,b,c){function d(){var c=b.find("svg"),d=[];c.length>0&&c.each(function(a){var b=$(this),c={};c.id=b.attr("id")||"svg-"+a,c.title=b.attr("title")||c.id,b.attr(c),d.push(c)}),a.getSvgs=d}var e=c.refresh||function(){return b.html()};a.$watch(e,d)}}}).controller("FileCtrl",function(){}).directive("fileDropzone",["$window","mimeType",function(a,b){return{restrict:"A",scope:{file:"=",fileName:"=",dropped:"="},link:function(c,d,e){function f(a){return null!==a&&a.preventDefault(),d.addClass("hover"),(a.dataTransfer||a.originalEvent.dataTransfer).effectAllowed="copy",!1}function g(a){return null!==a&&a.preventDefault(),d.removeClass("hover"),!1}function h(b){var c;return void 0===(c=e.maxFileSize)||""===c||b/1024/1024<e.maxFileSize?!0:(a.alert("File must be smaller than "+e.maxFileSize+" MB"),!1)}function i(b){return void 0===k||""===k||k.indexOf(b)>-1?!0:(a.alert("Invalid file type "+b+".  File must be one of following types "+k),!1)}function j(a){var d=new FileReader;d.onload=function(d){a.content=d.target.result;var e=b(a.name);return h(a.size)&&i(e)?c.$apply(function(){c.dropped(a)}):void 0},d.readAsText(a)}var k=e.fileDropzone;return d.bind("dragover",f),d.bind("dragenter",f),d.bind("dragleave",g),d.bind("drop",function(a){null!==a&&a.preventDefault(),d.removeClass("hover");for(var b=(a.dataTransfer||a.originalEvent.dataTransfer).files,c=0;c<b.length;c++){var e=b[c];j(e)}return!1})}}}])}(),function(){function a(a,b){var c=Papa.parse(a.content,b);angular.extend(a,c),a.table=!0}function b(a){return a.replace(/\r/g,"\n")}function c(a){var b=e[a.type];return b&&b.translate&&b.translate(a),a.isDirty=!1,a}function d(a){return{method:"GET",url:a.url,transformResponse:function(b,d){var e=d("Content-Type");return e&&(a.type=e.split(";")[0]),a.content=b,c(a)}}}var e={};e["text/tab-separated-values"]={translate:function(b){a(b,{header:!0,delimiter:"	",skipEmptyLines:!0})}},e["text/csv"]={translate:function(b){a(b,{header:!0,delimiter:",",skipEmptyLines:!0})}},e["text/plain"]={translate:function(a){a.content=b(a.content)}},e["application/json"]={translate:function(a){a.data=angular.fromJson(a.content),a.data.url&&a.data.url.indexOf("api.github.com")>-1&&(a.data.name=a.data.owner.login+"/"+a.data.id,a.path="gists/"+a.data.id)}},angular.module("myApp").factory("DataServiceFactory",["$http","$q","$log","mimeType",function(a,b,e,f){function g(a,b){this.conn=a||"data",this.id=b||"index"}return g.prototype.constructor=g,g.prototype.normalize=function(a){var b=this.conn+"/"+this.id;return angular.isObject(a)||(a={name:a,path:a,show:!0}),a.path=a.path||a.filename,!a.url&&a.path&&b&&(a.url=b+"/"+a.path),!a.name&&a.url&&(a.name=a.url.split("/").pop()),!a.type&&a.path&&(a.type=f(a.path)),a.path.indexOf("api.github.com")>-1&&(a.type=f("json")),0!==a.type.indexOf("text")&&"application/javascript"!==a.type&&(a.show=!1),a},g.prototype.loadResource=function(e){return!e.url||e.content||e.data?b(function(a){a({data:c(e)})}):a(d(e))},g.prototype.reparse=function(a){var b=1===arguments.length?[a]:this["package"].resources;b.forEach(c)},g.prototype.load=function(a,c){this.conn=a=a||this.conn||"data",this.id=c=c||this.id||"index";var d=this,e="gists"===a?["https://api.github.com",a,c]:["datapackage.json"],f=this.normalize({name:c,path:e.join("/"),show:!1});return this.loadResource(f).then(function(c){angular.extend(f,c.data.data),"gists"===a&&(f.resources=[],angular.forEach(f.files,function(a){f.resources.push(a)})),f.resources=f.resources||["index.html"],f.resources=f.resources.map(d.normalize,d);var e=f.resources.map(d.loadResource);return b.all(e).then(function(){return f})})},g}])}(),function(){angular.module("myApp").factory("mimeType",function(){function a(a){return a=a.toLowerCase().trim(),a.indexOf(".")>-1&&(a=a.split(".").pop()),b[a]||"unknown"}var b={"3gp":"video/3gpp",a:"application/octet-stream",ai:"application/postscript",aif:"audio/x-aiff",aiff:"audio/x-aiff",asc:"application/pgp-signature",asf:"video/x-ms-asf",asm:"text/x-asm",asx:"video/x-ms-asf",atom:"application/atom+xml",au:"audio/basic",avi:"video/x-msvideo",bat:"application/x-msdownload",bin:"application/octet-stream",bmp:"image/bmp",bz2:"application/x-bzip2",c:"text/x-csrc",cab:"application/vnd.ms-cab-compressed",can:"application/candor",cc:"text/x-c++src",chm:"application/vnd.ms-htmlhelp","class":"application/octet-stream",com:"application/x-msdownload",conf:"text/plain",cpp:"text/x-c",crt:"application/x-x509-ca-cert",css:"text/css",csv:"text/csv",cxx:"text/x-c",deb:"application/x-debian-package",der:"application/x-x509-ca-cert",diff:"text/x-diff",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dll:"application/x-msdownload",dmg:"application/octet-stream",doc:"application/msword",dot:"application/msword",dtd:"application/xml-dtd",dvi:"application/x-dvi",ear:"application/java-archive",eml:"message/rfc822",eps:"application/postscript",exe:"application/x-msdownload",f:"text/x-fortran",f77:"text/x-fortran",f90:"text/x-fortran",flv:"video/x-flv","for":"text/x-fortran",gem:"application/octet-stream",gemspec:"text/x-script.ruby",gif:"image/gif",gyp:"text/x-script.python",gypi:"text/x-script.python",gz:"application/x-gzip",h:"text/x-chdr",hh:"text/x-c++hdr",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",ifb:"text/calendar",iso:"application/octet-stream",jar:"application/java-archive",java:"text/x-java-source",jnlp:"application/x-java-jnlp-file",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/javascript",json:"application/json",less:"text/css",log:"text/plain",lua:"text/x-script.lua",luac:"application/x-bytecode.lua",makefile:"text/x-makefile",m3u:"audio/x-mpegurl",m4v:"video/mp4",man:"text/troff",manifest:"text/cache-manifest",markdown:"text/x-markdown",mathml:"application/mathml+xml",mbox:"application/mbox",mdoc:"text/troff",md:"text/x-markdown",me:"text/troff",mid:"audio/midi",midi:"audio/midi",mime:"message/rfc822",mml:"application/mathml+xml",mng:"video/x-mng",mov:"video/quicktime",mp3:"audio/mpeg",mp4:"video/mp4",mp4v:"video/mp4",mpeg:"video/mpeg",mpg:"video/mpeg",ms:"text/troff",msi:"application/x-msdownload",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",ogg:"application/ogg",p:"text/x-pascal",pas:"text/x-pascal",pbm:"image/x-portable-bitmap",pdf:"application/pdf",pem:"application/x-x509-ca-cert",pgm:"image/x-portable-graymap",pgp:"application/pgp-encrypted",pkg:"application/octet-stream",pl:"text/x-script.perl",pm:"text/x-script.perl-module",png:"image/png",pnm:"image/x-portable-anymap",ppm:"image/x-portable-pixmap",pps:"application/vnd.ms-powerpoint",ppt:"application/vnd.ms-powerpoint",ps:"application/postscript",psd:"image/vnd.adobe.photoshop",py:"text/x-script.python",qt:"video/quicktime",ra:"audio/x-pn-realaudio",rake:"text/x-script.ruby",ram:"audio/x-pn-realaudio",rar:"application/x-rar-compressed",rb:"text/x-script.ruby",rdf:"application/rdf+xml",roff:"text/troff",rpm:"application/x-redhat-package-manager",rss:"application/rss+xml",rtf:"application/rtf",ru:"text/x-script.ruby",s:"text/x-asm",sgm:"text/sgml",sgml:"text/sgml",sh:"application/x-sh",sig:"application/pgp-signature",snd:"audio/basic",so:"application/octet-stream",svg:"image/svg+xml",svgz:"image/svg+xml",swf:"application/x-shockwave-flash",t:"text/troff",tar:"application/x-tar",tbz:"application/x-bzip-compressed-tar",tci:"application/x-topcloud",tcl:"application/x-tcl",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",text:"text/plain",tif:"image/tiff",tiff:"image/tiff",torrent:"application/x-bittorrent",tr:"text/troff",tsv:"text/tab-separated-values",ttf:"application/x-font-ttf",txt:"text/plain",vcf:"text/x-vcard",vcs:"text/x-vcalendar",vrml:"model/vrml",war:"application/java-archive",wav:"audio/x-wav",webapp:"application/x-web-app-manifest+json",webm:"video/webm",wma:"audio/x-ms-wma",wmv:"video/x-ms-wmv",wmx:"video/x-ms-wmx",wrl:"model/vrml",wsdl:"application/wsdl+xml",xbm:"image/x-xbitmap",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xslt:"application/xslt+xml",yaml:"text/yaml",yml:"text/yaml",zip:"application/zip"};return a})}(),angular.module("myApp").directive("reportInclude",["$window","$compile","$timeout","$log","debounce","DataServiceFactory",function(a,b,c,d,e,f){return{restrict:"AE",scope:{dataPackage:"=data",isPrintView:"=printView"},template:'<div id="report-body" class="report-container" ng-class="{ dirty: dataPackage.isDirty }" ng-cloak />',link:function(c,g,h){function i(){n=g.width(),m=g.height()}function j(){(n>0&&n!==g.width()||m!==g.height())&&o()}function k(){d.debug("Generating report"),c.isDirty&&d.debug("Reparsing data package");var e={head:"",body:"",endBody:"",js:[]};angular.forEach(c.dataPackage.resources,function(a){a.isDirty&&f.prototype.reparse(a),"index.html"===a.name||"index.htm"===a.name?e.body+=a.content:"README.md"===a.name?e.body+="<marked>"+a.content+"</marked>":"text/css"===a.type?e.head+="<style>"+a.content+"</style>":"application/javascript"===a.type&&e.js.push(a.content+"//@ sourceURL="+a.path)}),a.$dataPackage=c.dataPackage,l.html([e.head,e.body,e.endBody].join("")),b(l.contents())(c),e.js.forEach(a.eval),d.debug("Generating report - done"),c.dataPackage.isDirty=!1,i()}var l=g.find("div");d.debug("Report data",c.dataPackage);var m,n;k();var o=e(k,1e3);c.$on(h.refreshOn,o),a.addEventListener("resize",j)}}}]).directive("ngShadow",function(){return{restrict:"A",transclude:!0,template:'<div id="shadowtranscludeparent"><div id="shadowtransclude" ng-transclude></div></div>',link:function(){var a=document.querySelector("#shadowtranscludeparent").createShadowRoot(),b=document.querySelector("#shadowtransclude");a.appendChild(b)}}});